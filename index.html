<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Scene with Background Camera</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://aframe.io/releases/1.3.0/aframe-ar.js"></script>
    <style>
        body { margin: 0; }
        a-scene { width: 100vw; height: 100vh; }
        #button-container { position: absolute; top: 10px; left: 10px; z-index: 1; }
    </style>
</head>
<body>
    <a-scene embedded arjs="sourceType: webcam;">
        <!-- Caméra AR -->
        <a-camera gps-camera rotation-reader></a-camera>

        <!-- Modèle 3D -->
        <a-entity
            id="ar-model"
            gltf-model="url(test.glb)"
            position="0 0 -5"  <!-- Position initiale -->
            scale="1 1 1">
        </a-entity>

        <!-- Zone pour afficher les coordonnées du modèle -->
        <a-entity id="model-position" text="value: Position: (0, 0, -5); color: #FFF;"
                  position="0 1 -3" scale="2 2 2">
        </a-entity>
    </a-scene>

    <!-- Boutons pour fixer et réinitialiser la position -->
    <div id="button-container">
        <button id="set-position">Fixer la Position</button>
        <button id="reset-position">Réinitialiser la Position</button>
    </div>

    <script>
        const arModel = document.getElementById('ar-model');
        const modelPosition = document.getElementById('model-position');

        // Fonction pour mettre à jour la position dans le stockage local
        function updatePosition() {
            const position = arModel.object3D.position;
            localStorage.setItem('modelPosition', JSON.stringify({
                x: position.x,
                y: position.y,
                z: position.z
            }));
            modelPosition.setAttribute('text', `value: Position: (${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)}); color: #FFF;`);
        }

        // Fonction pour récupérer et appliquer la position enregistrée
        function applyStoredPosition() {
            const storedPosition = JSON.parse(localStorage.getItem('modelPosition'));
            if (storedPosition) {
                arModel.setAttribute('position', `${storedPosition.x} ${storedPosition.y} ${storedPosition.z}`);
                modelPosition.setAttribute('text', `value: Position: (${storedPosition.x.toFixed(2)}, ${storedPosition.y.toFixed(2)}, ${storedPosition.z.toFixed(2)}); color: #FFF;`);
            }
        }

        // Initialiser la position du modèle lorsque la page se charge
        applyStoredPosition();

        // Ajouter des écouteurs d'événements pour les boutons
        document.getElementById('set-position').addEventListener('click', updatePosition);
        document.getElementById('reset-position').addEventListener('click', () => {
            localStorage.removeItem('modelPosition');
            applyStoredPosition(); // Appliquer la position initiale
        });
    </script>
</body>
</html>
